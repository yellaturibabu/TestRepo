(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/router",[],function(){var a;return a=function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}c.prototype.routes={"":"showCurrent",current:"showCurrent",past:"showPast"};c.prototype.initialize=function(a){return this.options=a};c.prototype.showCurrent=function(){this.navigate("current");return this.options.app.state.set({active:true})};c.prototype.showPast=function(){this.navigate("past");return this.options.app.state.set({active:false})};return c}(Backbone.Router)})}).call(this);this["Templates"]=this["Templates"]||{};this["Templates"]["analysis-reports-actions"]=Handlebars.template({1:function(a,b,c,d){return"selected"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=b.helperMissing,g=this.escapeExpression,h='<ul class="tabs">\n  <li><a class="js-show-current-activity ';e=b["if"].call(a,(e=a!=null?a.state:a)!=null?e.active:e,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){h+=e}h+='">'+g((b.t||a&&a.t||f).call(a,"analysis_reports.current_activity",{name:"t",hash:{},data:d}))+'</a></li>\n  <li><a class="js-show-past-reports ';e=b.unless.call(a,(e=a!=null?a.state:a)!=null?e.active:e,{name:"unless",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){h+=e}return h+'">'+g((b.t||a&&a.t||f).call(a,"analysis_reports.past_reports",{name:"t",hash:{},data:d}))+'</a></li>\n</ul>\n\n<div class="analysis-reports-total">'+g((b.tp||a&&a.tp||f).call(a,"analysis_reports.x_reports",a!=null?a.total:a,{name:"tp",hash:{},data:d}))+"</div>\n"},useData:true});this["Templates"]["analysis-reports-empty"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return"No reports to show\n"},useData:true});this["Templates"]["analysis-reports-layout"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return'<header class="page-header">\n  <h1 class="page-title">'+f((b.t||a&&a.t||e).call(a,"analysis_reports.page",{name:"t",hash:{},data:d}))+'</h1>\n  <p class="page-description">\n    The server is in charge to process reports submitted by batch analyses. This page allows to monitor the queue of\n    pending reports to process, and gives access to the history of past analyses.\n  </p>\n</header>\n\n<div class="analysis-reports-actions"></div>\n<div class="analysis-reports-results"></div>\n'},useData:true});this["Templates"]["analysis-reports-report"]=Handlebars.template({1:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return"Submitted: "+f((b.dt||a&&a.dt||e).call(a,a!=null?a.submittedAt:a,{name:"dt",hash:{},data:d}))+"<br>"},3:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return"Started: "+f((b.dt||a&&a.dt||e).call(a,a!=null?a.startedAt:a,{name:"dt",hash:{},data:d}))+"<br>"},5:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return"Finished: "+f((b.dt||a&&a.dt||e).call(a,a!=null?a.finishedAt:a,{name:"dt",hash:{},data:d}))+"<br>"},7:function(a,b,c,d){var e,f=b.helperMissing,g=this.lambda,h=this.escapeExpression,i='    <span class="analysis-reports-timestamp line-small">\n      Duration:\n      ';e=(b.gt||a&&a.gt||f).call(a,(e=a!=null?a.duration:a)!=null?e.hours:e,0,{name:"gt",hash:{},fn:this.program(8,d),inverse:this.noop,data:d});if(e!=null){i+=e}i+="\n      ";e=(b.gt||a&&a.gt||f).call(a,(e=a!=null?a.duration:a)!=null?e.minutes:e,0,{name:"gt",hash:{},fn:this.program(10,d),inverse:this.noop,data:d});if(e!=null){i+=e}return i+"\n      "+h(g((e=a!=null?a.duration:a)!=null?e.seconds:e,a))+"s\n    </span>\n"},8:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return g(f((e=a!=null?a.duration:a)!=null?e.hours:e,a))+"h"},10:function(a,b,c,d){var e,f=this.lambda,g=this.escapeExpression;return g(f((e=a!=null?a.duration:a)!=null?e.minutes:e,a))+"m"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g=b.helperMissing,h=this.escapeExpression,i="function",j='<div class="line">\n  <span class="analysis-reports-project">\n    <i class="icon-qualifier-trk"></i>\n    <a href="'+h((b.dashboardUrl||a&&a.dashboardUrl||g).call(a,a!=null?a.projectKey:a,{name:"dashboardUrl",hash:{},data:d}))+'">'+h((f=(f=b.projectName||(a!=null?a.projectName:a))!=null?f:g,typeof f===i?f.call(a,{name:"projectName",hash:{},data:d}):f))+'</a>\n  </span>\n\n  <span class="analysis-reports-timestamp line-small">\n    ';e=b["if"].call(a,a!=null?a.submittedAt:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+="\n    ";e=b["if"].call(a,a!=null?a.startedAt:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+="\n    ";e=b["if"].call(a,a!=null?a.finishedAt:a,{name:"if",hash:{},fn:this.program(5,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+="\n  </span>\n\n";e=b["if"].call(a,a!=null?a.duration:a,{name:"if",hash:{},fn:this.program(7,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j+'\n</div>\n\n<div class="analysis-reports-report-id">'+h((f=(f=b.key||(a!=null?a.key:a))!=null?f:g,typeof f===i?f.call(a,{name:"key",hash:{},data:d}):f))+" "+h((f=(f=b.status||(a!=null?a.status:a))!=null?f:g,typeof f===i?f.call(a,{name:"status",hash:{},data:d}):f))+"</div>\n"},useData:true});define("templates/analysis-reports",function(){});(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/layout",["templates/analysis-reports"],function(){return function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}c.prototype.template=Templates["analysis-reports-layout"];c.prototype.regions={actionsRegion:".analysis-reports-actions",resultsRegion:".analysis-reports-results"};c.prototype.showSpinner=function(a){return this[a].show(new Marionette.ItemView({template:_.template('<i class="spinner"></i>')}))};return c}(Marionette.Layout)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/models/report",[],function(){return function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}return c}(Backbone.Model)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/models/reports",["analysis-reports/models/report"],function(a){return function(c){b(d,c);function d(){return d.__super__.constructor.apply(this,arguments)}d.prototype.model=a;d.prototype.parse=function(a){this.paging={page:a.p,pageSize:a.ps,total:a.total,maxResultsReached:a.p*a.ps>=a.total};return a.reports};d.prototype.fetchActive=function(){return this.fetch({url:""+baseUrl+"/api/computation/queue"},{reset:true})};d.prototype.fetchHistory=function(a){if(a==null){a={}}_.extend(a,{url:""+baseUrl+"/api/computation/history"});a.data=a.data||{};a.data.ps=50;return this.fetch(a,{reset:true})};return d}(Backbone.Collection)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/views/report-view",["templates/analysis-reports"],function(){return function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}c.prototype.tagName="li";c.prototype.template=Templates["analysis-reports-report"];c.prototype.onRender=function(){var a;a=this.model.get("status");if(a==="PENDING"){this.$el.addClass("analysis-reports-report-pending")}if(a==="WORKING"){this.$el.addClass("analysis-reports-report-working")}if(a==="SUCCESS"){this.$el.addClass("analysis-reports-report-done")}if(a==="CANCELLED"){this.$el.addClass("analysis-reports-report-cancelled")}if(a==="FAIL"){return this.$el.addClass("analysis-reports-report-failed")}};c.prototype.serializeData=function(){var a,b,d;a=null;if(this.model.has("startedAt")&&this.model.has("finishedAt")){d=moment(this.model.get("startedAt"));b=moment(this.model.get("finishedAt"));a=b.diff(d);a={seconds:Math.floor(a/1e3%60),minutes:Math.floor(a/(1e3*60)%60),hours:Math.floor(a/(1e3*60*60)%24)}}return _.extend(c.__super__.serializeData.apply(this,arguments),{duration:a})};return c}(Marionette.ItemView)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/views/reports-empty-view",["templates/analysis-reports"],function(){return function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}c.prototype.className="analysis-reports-no-results";c.prototype.tagName="li";c.prototype.template=Templates["analysis-reports-empty"];return c}(Marionette.ItemView)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/views/reports-view",["analysis-reports/views/report-view","analysis-reports/views/reports-empty-view"],function(a,c){var d;d=jQuery;return function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="ol";f.prototype.className="navigator-results-list";f.prototype.itemView=a;f.prototype.emptyView=c;f.prototype.itemViewOptions=function(){return{listView:this,app:this.options.app}};f.prototype.initialize=function(){return this.loadMoreThrottled=_.throttle(this.loadMore,200)};f.prototype.onClose=function(){return this.unbindScrollEvents()};f.prototype.bindScrollEvents=function(){return d(window).on("scroll",function(a){return function(){return a.loadMoreThrottled()}}(this))};f.prototype.unbindScrollEvents=function(){return d(window).off("scroll")};f.prototype.loadMore=function(){var a;a=this.children.findByIndex(this.collection.length-1);if(d(window).scrollTop()+d(window).outerHeight()>=a.$el.offset().top-40){this.unbindScrollEvents();return this.options.app.fetchNextPage().done(function(a){return function(){if(!a.collection.paging.maxResultsReached){return a.bindScrollEvents()}}}(this))}};return f}(Marionette.CollectionView)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("analysis-reports/views/actions-view",["templates/analysis-reports"],function(){return function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}c.prototype.template=Templates["analysis-reports-actions"];c.prototype.events={"click .js-show-past-reports":"showPastReports","click .js-show-current-activity":"showCurrentActivity"};c.prototype.initialize=function(a){this.listenTo(a.collection,"all",this.render);return this.listenTo(a.app.state,"change",this.render)};c.prototype.showPastReports=function(){return this.options.app.router.navigate("past",{trigger:true})};c.prototype.showCurrentActivity=function(){return this.options.app.router.navigate("current",{trigger:true})};c.prototype.serializeData=function(){return _.extend(c.__super__.serializeData.apply(this,arguments),{state:this.options.app.state.toJSON(),total:this.collection.paging.total||this.collection.length})};return c}(Marionette.ItemView)})}).call(this);(function(){requirejs.config({baseUrl:""+baseUrl+"/js"});requirejs(["analysis-reports/router","analysis-reports/layout","analysis-reports/models/reports","analysis-reports/views/reports-view","analysis-reports/views/actions-view"],function(a,b,c,d,e){var f,g;jQuery("html").addClass("navigator-page");f=new Marionette.Application;f.fetchReports=function(){var a;a=this.state.get("active")?this.reports.fetchActive():this.reports.fetchHistory();this.layout.showSpinner("actionsRegion");this.layout.resultsRegion.reset();return a.done(function(a){return function(){a.state.set({page:a.reports.paging.page});a.reportsView=new d({app:a,collection:a.reports});a.layout.resultsRegion.show(a.reportsView);if(!(a.state.get("active")||a.reports.paging.maxResultsReached)){if(!a.state.get("active")){a.reportsView.bindScrollEvents()}}a.actionsView=new e({app:a,collection:a.reports});return a.layout.actionsRegion.show(a.actionsView)}}(this))};f.fetchNextPage=function(){return this.reports.fetchHistory({data:{p:this.state.get("page")+1},remove:false}).done(function(a){return function(){return a.state.set({page:a.reports.paging.page})}}(this))};f.addInitializer(function(){this.state=new Backbone.Model;return this.state.on("change:active",function(a){return function(){return a.fetchReports()}}(this))});f.addInitializer(function(){this.layout=new b({app:this});return jQuery("#analysis-reports").empty().append(this.layout.render().el)});f.addInitializer(function(){this.reports=new c;this.router=new a({app:this});return Backbone.history.start()});g=window.requestMessages();return jQuery.when(g).done(function(){return f.start()})})}).call(this);define("analysis-reports/app",function(){});