this["Templates"]=this["Templates"]||{};this["Templates"]["ajax-select-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="navigator-filter-search">\n  <input type="text">\n</div>\n<ul class="navigator-filter-select-list choices"></ul>\n<ul class="navigator-filter-select-list opposite"></ul>\n'},useData:true});this["Templates"]["base-details-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<div class="navigator-filter-details-inner"></div>\n'},useData:true});this["Templates"]["base-filter"]=Handlebars.template({1:function(a,b,c,d){return"default"},3:function(a,b,c,d){return'  <div class="navigator-filter-disable">&times;</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<div class="navigator-filter-label">'+i((f=(f=b.name||(a!=null?a.name:a))!=null?f:h,typeof f===g?f.call(a,{name:"name",hash:{},data:d}):f))+'</div>\n<div class="navigator-filter-value ';e=b["if"].call(a,a!=null?a.defaultValue:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+='">'+i((f=(f=b.value||(a!=null?a.value:a))!=null?f:h,typeof f===g?f.call(a,{name:"value",hash:{},data:d}):f))+"</div>\n";e=b["if"].call(a,a!=null?a.optional:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j},useData:true});this["Templates"]["checkbox-filter"]=Handlebars.template({1:function(a,b,c,d){return'  <div class="navigator-filter-disable">&times;</div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<div class="navigator-filter-label">'+i((f=(f=b.name||(a!=null?a.name:a))!=null?f:h,typeof f===g?f.call(a,{name:"name",hash:{},data:d}):f))+"</div>\n";e=b["if"].call(a,a!=null?a.optional:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j},useData:true});this["Templates"]["choice-filter-item"]=Handlebars.template({1:function(a,b,c,d){return"icon-checkbox-checked"},3:function(a,b,c,d){return"icon-checkbox-single"},5:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'<i class="icon-'+h((e=(e=b.icon||(a!=null?a.icon:a))!=null?e:g,typeof e===f?e.call(a,{name:"icon",hash:{},data:d}):e))+'"></i>'},7:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'      <br>\n      <span>\n        <i class="icon-checkbox icon-checkbox-invisible"></i>\n        <span class="subtitle">'+h((e=(e=b.category||(a!=null?a.category:a))!=null?e:g,typeof e===f?e.call(a,{name:"category",hash:{},data:d}):e))+"</span>\n      </span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<li>\n  <label title="'+i((f=(f=b.text||(a!=null?a.text:a))!=null?f:h,typeof f===g?f.call(a,{name:"text",hash:{},data:d}):f))+'" data-id="'+i((f=(f=b.id||(a!=null?a.id:a))!=null?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'">\n    <span>\n      <i class="icon-checkbox ';e=b["if"].call(a,a!=null?a.checked:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+=" ";e=b.unless.call(a,a!=null?a.multiple:a,{name:"unless",hash:{},fn:this.program(3,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+='"></i>\n      ';e=b["if"].call(a,a!=null?a.icon:a,{name:"if",hash:{},fn:this.program(5,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+="\n      "+i((f=(f=b.text||(a!=null?a.text:a))!=null?f:h,typeof f===g?f.call(a,{name:"text",hash:{},data:d}):f))+"\n    </span>\n";e=b["if"].call(a,a!=null?a.category:a,{name:"if",hash:{},fn:this.program(7,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j+"  </label>\n</li>\n"},useData:true});this["Templates"]["choice-filter-template"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return""},useData:true});this["Templates"]["choice-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'<ul class="navigator-filter-select-list choices"></ul>\n<ul class="navigator-filter-select-list opposite"></ul>\n'},useData:true});this["Templates"]["favorite-details-filter"]=Handlebars.template({1:function(a,b,c,d){var e,f='  <ul class="navigator-filter-select-list">\n';e=b.each.call(a,a!=null?a.choicesArray:a,{name:"each",hash:{},fn:this.program(2,d),inverse:this.noop,data:d});if(e!=null){f+=e}return f+"  </ul>\n"},2:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'      <li>\n        <label data-id="'+h((e=(e=b.k||(a!=null?a.k:a))!=null?e:g,typeof e===f?e.call(a,{name:"k",hash:{},data:d}):e))+'">'+h((e=(e=b.v||(a!=null?a.v:a))!=null?e:g,typeof e===f?e.call(a,{name:"v",hash:{},data:d}):e))+"</label>\n      </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=b.helperMissing,g=this.escapeExpression,h="";e=(b.ifNotEmpty||a&&a.ifNotEmpty||f).call(a,a!=null?a.choicesArray:a,{name:"ifNotEmpty",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){h+=e}return h+'<ul class="navigator-filter-select-list">\n  <li class="manage">\n    <label id="manage-favorites">'+g((b.translate||a&&a.translate||f).call(a,"manage",{name:"translate",hash:{},data:d}))+"</label>\n  </li>\n</ul>\n"},useData:true});this["Templates"]["favorite-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return'<div class="navigator-filter-favorite-toggle" title="'+f((b.translate||a&&a.translate||e).call(a,"filtersList",{name:"translate",hash:{},data:d}))+'"></div>\n'},useData:true});this["Templates"]["metric-filter"]=Handlebars.template({1:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='      <optgroup label="'+i((f=(f=b.domain||(a!=null?a.domain:a))!=null?f:h,typeof f===g?f.call(a,{name:"domain",hash:{},data:d}):f))+'">\n';e=b.each.call(a,a!=null?a.metrics:a,{name:"each",hash:{},fn:this.program(2,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j+"      </optgroup>\n"},2:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'          <option value="'+h((e=(e=b.name||(a!=null?a.name:a))!=null?e:g,typeof e===f?e.call(a,{name:"name",hash:{},data:d}):e))+'">'+h((e=(e=b.short_name||(a!=null?a.short_name:a))!=null?e:g,typeof e===f?e.call(a,{name:"short_name",hash:{},data:d}):e))+"</option>\n"},4:function(a,b,c,d){var e=this.lambda,f=this.escapeExpression;return'      <option value="'+f(e(d&&d.key,a))+'">'+f(e(a,a))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=b.helperMissing,g=this.escapeExpression,h='<div class="navigator-filter-details-inner">\n  <select name="metric">\n    <option></option>\n';e=b.each.call(a,a!=null?a.groupedMetrics:a,{name:"each",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){h+=e}h+='  </select>\n\n  <select name="period">\n    <option value="0">'+g((b.translate||a&&a.translate||f).call(a,"value",{name:"translate",hash:{},data:d}))+"</option>\n";e=b.each.call(a,a!=null?a.periods:a,{name:"each",hash:{},fn:this.program(4,d),inverse:this.noop,data:d});if(e!=null){h+=e}h+='  </select>\n\n  <select name="op">\n';e=b.each.call(a,a!=null?a.operations:a,{name:"each",hash:{},fn:this.program(4,d),inverse:this.noop,data:d});if(e!=null){h+=e}return h+'  </select>\n\n  <input type="text" name="val">\n</div>\n'},useData:true});this["Templates"]["more-criteria-details-filter"]=Handlebars.template({1:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='    <li>\n      <label data-id="'+i((f=(f=b.id||(a!=null?a.id:a))!=null?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'" data-property="'+i((f=(f=b.property||(a!=null?a.property:a))!=null?f:h,typeof f===g?f.call(a,{name:"property",hash:{},data:d}):f))+'" ';e=b["if"].call(a,a!=null?a.inactive:a,{name:"if",hash:{},fn:this.program(2,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+=" ";e=b["if"].call(a,a!=null?a.title:a,{name:"if",hash:{},fn:this.program(4,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j+">\n        "+i((f=(f=b.name||(a!=null?a.name:a))!=null?f:h,typeof f===g?f.call(a,{name:"name",hash:{},data:d}):f))+"\n      </label>\n    </li>\n"},2:function(a,b,c,d){return'class="inactive"'},4:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'title="'+h((e=(e=b.title||(a!=null?a.title:a))!=null?e:g,typeof e===f?e.call(a,{name:"title",hash:{},data:d}):e))+'"'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f='<ul class="navigator-filter-select-list">\n';e=b.each.call(a,a!=null?a.filters:a,{name:"each",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){f+=e}return f+"</ul>\n"},useData:true});this["Templates"]["more-criteria-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return f((b.t||a&&a.t||e).call(a,"moreCriteria",{name:"t",hash:{},data:d}))+"\n"},useData:true});this["Templates"]["range-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'<div class="navigator-filter-details-inner">\n  <input class="navigator-filter-range-input" type="text" name="'+h((e=(e=b.propertyFrom||(a!=null?a.propertyFrom:a))!=null?e:g,typeof e===f?e.call(a,{name:"propertyFrom",hash:{},data:d}):e))+'" placeholder="'+h((e=(e=b.placeholder||(a!=null?a.placeholder:a))!=null?e:g,typeof e===f?e.call(a,{name:"placeholder",hash:{},data:d}):e))+'">\n  <label>'+h((b.translate||a&&a.translate||g).call(a,"to",{name:"translate",hash:{},data:d}))+'</label>\n  <input class="navigator-filter-range-input" type="text" name="'+h((e=(e=b.propertyTo||(a!=null?a.propertyTo:a))!=null?e:g,typeof e===f?e.call(a,{name:"propertyTo",hash:{},data:d}):e))+'" placeholder="'+h((e=(e=b.placeholder||(a!=null?a.placeholder:a))!=null?e:g,typeof e===f?e.call(a,{name:"placeholder",hash:{},data:d}):e))+'">\n</div>\n'},useData:true});this["Templates"]["string-filter"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return'<div class="navigator-filter-details-inner">\n  <input type="text" name="'+h((e=(e=b.property||(a!=null?a.property:a))!=null?e:g,typeof e===f?e.call(a,{name:"property",hash:{},data:d}):e))+'" value="'+h((e=(e=b.value||(a!=null?a.value:a))!=null?e:g,typeof e===f?e.call(a,{name:"value",hash:{},data:d}):e))+'">\n</div>\n'},useData:true});define("templates/navigator",function(){});define("navigator/filters/base-filters",["templates/navigator"],function(){var a=Backbone.Model.extend({defaults:{enabled:true,optional:false,multiple:true,placeholder:""}});var b=Backbone.Collection.extend({model:a});var c=Marionette.ItemView.extend({template:Templates["base-details-filter"],className:"navigator-filter-details",initialize:function(){this.$el.on("click",function(a){a.stopPropagation()});this.$el.attr("id","filter-"+this.model.get("property"))},onShow:function(){},onHide:function(){}});var d=Marionette.ItemView.extend({template:Templates["base-filter"],className:"navigator-filter",events:function(){return{click:"toggleDetails","click .navigator-filter-disable":"disable"}},modelEvents:{"change:enabled":"focus","change:value":"renderBase","change:filters":"render"},initialize:function(a){Marionette.ItemView.prototype.initialize.apply(this,arguments);var b=a&&a.detailsView||c;this.detailsView=new b({model:this.model,filterView:this});this.model.view=this},attachDetailsView:function(){this.detailsView.$el.detach().appendTo($j("body"))},render:function(){this.renderBase();this.attachDetailsView();this.detailsView.render();this.$el.toggleClass("navigator-filter-disabled",!this.model.get("enabled"));this.$el.toggleClass("navigator-filter-optional",this.model.get("optional"))},renderBase:function(){Marionette.ItemView.prototype.render.apply(this,arguments);this.renderInput();var a=this.model.get("name")+": "+this.renderValue();this.$el.prop("title",a);this.$el.attr("data-property",this.model.get("property"))},renderInput:function(){},focus:function(){this.render()},toggleDetails:function(a){a.stopPropagation();this.options.filterBarView.selected=this.options.filterBarView.getEnabledFilters().index(this.$el);if(this.$el.hasClass("active")){key.setScope("list");this.hideDetails()}else{key.setScope("filters");this.showDetails()}},showDetails:function(){this.registerShowedDetails();var a=this.$el.offset().top+this.$el.outerHeight()-1,b=this.$el.offset().left;this.detailsView.$el.css({top:a,left:b}).addClass("active");this.$el.addClass("active");this.detailsView.onShow()},registerShowedDetails:function(){this.options.filterBarView.hideDetails();this.options.filterBarView.showedView=this},hideDetails:function(){this.detailsView.$el.removeClass("active");this.$el.removeClass("active");this.detailsView.onHide()},isActive:function(){return this.$el.is(".active")},renderValue:function(){return this.model.get("value")||"unset"},isDefaultValue:function(){return true},restoreFromQuery:function(a){var b=_.findWhere(a,{key:this.model.get("property")});if(b&&b.value){this.model.set("enabled",true);this.restore(b.value,b)}else{this.clear()}},restore:function(a){this.model.set({value:a},{silent:true});this.renderBase()},clear:function(){this.model.unset("value")},disable:function(a){a.stopPropagation();this.hideDetails();this.options.filterBarView.hideDetails();this.model.set({enabled:false,value:null})},formatValue:function(){var a={};if(this.model.has("property")&&this.model.has("value")&&this.model.get("value")){a[this.model.get("property")]=this.model.get("value")}return a},serializeData:function(){return _.extend({},this.model.toJSON(),{value:this.renderValue(),defaultValue:this.isDefaultValue()})}});return{Filter:a,Filters:b,BaseFilterView:d,DetailsFilterView:c}});define("navigator/filters/choice-filters",["navigator/filters/base-filters","templates/navigator"],function(a){var b=a.DetailsFilterView.extend({template:Templates["choice-filter"],itemTemplate:Templates["choice-filter-item"],events:function(){return{"click label":"onCheck"}},render:function(){a.DetailsFilterView.prototype.render.apply(this,arguments);this.updateLists()},renderList:function(a,b){var c=this,d=this.$(b);d.empty().toggleClass("hidden",a.length===0);a.each(function(a){d.append(c.itemTemplate(_.extend(a.toJSON(),{multiple:c.model.get("multiple")&&a.get("id")[0]!=="!"})))})},updateLists:function(){var a=new Backbone.Collection(this.options.filterView.choices.reject(function(a){return a.get("id")[0]==="!"})),b=new Backbone.Collection(this.options.filterView.choices.filter(function(a){return a.get("id")[0]==="!"}));this.renderList(a,".choices");this.renderList(b,".opposite");var c=this.currentChoice||0;this.updateCurrent(c)},onCheck:function(a){var b=jQuery(a.currentTarget),c=b.data("id"),d=b.find(".icon-checkbox-checked").length>0;if(this.model.get("multiple")){if(b.closest(".opposite").length>0){this.options.filterView.choices.each(function(a){a.set("checked",false)})}else{this.options.filterView.choices.filter(function(a){return a.get("id")[0]==="!"}).forEach(function(a){a.set("checked",false)})}}else{this.options.filterView.choices.each(function(a){a.set("checked",false)})}this.options.filterView.choices.get(c).set("checked",!d);this.updateValue();this.updateLists()},updateValue:function(){this.model.set("value",this.options.filterView.getSelected().map(function(a){return a.get("id")}))},updateCurrent:function(a){this.currentChoice=a;this.$("label").removeClass("current").eq(this.currentChoice).addClass("current")},onShow:function(){this.bindedOnKeyDown=_.bind(this.onKeyDown,this);$j("body").on("keydown",this.bindedOnKeyDown)},onHide:function(){$j("body").off("keydown",this.bindedOnKeyDown)},onKeyDown:function(a){switch(a.keyCode){case 38:a.preventDefault();this.selectPrevChoice();break;case 40:a.preventDefault();this.selectNextChoice();break;case 13:a.preventDefault();this.selectCurrent();break;default:break}},selectNextChoice:function(){if(this.$("label").length>this.currentChoice+1){this.updateCurrent(this.currentChoice+1);this.scrollNext()}},scrollNext:function(){var a=this.$("label").eq(this.currentChoice);if(a.length>0){var b=a.closest("ul"),c=a.offset().top-b.offset().top+b.scrollTop(),d=c-b.height()+a.outerHeight();if(d>0){b.scrollTop(d)}}},selectPrevChoice:function(){if(this.currentChoice>0){this.updateCurrent(this.currentChoice-1);this.scrollPrev()}},scrollPrev:function(){var a=this.$("label").eq(this.currentChoice);if(a.length>0){var b=a.closest("ul"),c=a.offset().top-b.offset().top;if(c<0){b.scrollTop(b.scrollTop()+c)}}},selectCurrent:function(){var a=this.$("label").eq(this.currentChoice);a.click()},serializeData:function(){return _.extend({},this.model.toJSON(),{choices:new Backbone.Collection(this.options.filterView.choices.reject(function(a){return a.get("id")[0]==="!"})).toJSON(),opposite:new Backbone.Collection(this.options.filterView.choices.filter(function(a){return a.get("id")[0]==="!"})).toJSON()})}});var c=a.BaseFilterView.extend({initialize:function(c){a.BaseFilterView.prototype.initialize.call(this,{detailsView:c&&c.detailsView?c.detailsView:b});var d=0,e=this.model.get("choiceIcons");this.choices=new Backbone.Collection(_.map(this.model.get("choices"),function(a,b){var c=new Backbone.Model({id:b,text:a,checked:false,index:d++});if(e&&e[b]){c.set("icon",e[b])}return c}),{comparator:"index"})},getSelected:function(){return this.choices.filter(function(a){return a.get("checked")})},renderInput:function(){var a=$j("<select>").prop("name",this.model.get("property")).prop("multiple",true).css("display","none");this.choices.each(function(b){var c=$j("<option>").prop("value",b.get("id")).prop("selected",b.get("checked")).text(b.get("text"));c.appendTo(a)});a.appendTo(this.$el)},renderValue:function(){var a=this.getSelected().map(function(a){return a.get("text")}),b=this.model.has("defaultValue")?this.model.get("defaultValue"):this.model.get("multiple")?t("all"):t("any");return this.isDefaultValue()?b:a.join(", ")},isDefaultValue:function(){var a=this.getSelected();return a.length===0},disable:function(){this.choices.each(function(a){a.set("checked",false)});a.BaseFilterView.prototype.disable.apply(this,arguments)},restoreFromQuery:function(a){var b=_.findWhere(a,{key:this.model.get("property")});if(this.choices){this.choices.forEach(function(c){if(c.get("id")[0]==="!"){var d=_.findWhere(a,{key:c.get("id").substr(1)});if(c.get("id").indexOf("=")>=0){var e=c.get("id").split("=")[0].substr(1);var f=c.get("id").split("=")[1];d=_.findWhere(a,{key:e,value:f})}if(d==null){return}if(!b){b={value:c.get("id")}}else{b.value+=","+c.get("id")}}})}if(b&&b.value){this.model.set("enabled",true);this.restore(b.value,b)}else{this.clear()}},restore:function(a){if(_.isString(a)){a=a.split(",")}if(this.choices&&a.length>0){var b=this;b.choices.each(function(a){a.set("checked",false)});var c=[];_.each(a,function(a){var d=b.choices.findWhere({id:a});if(d){d.set("checked",true)}else{c.push(a)}});a=_.difference(a,c);this.model.set({value:a,enabled:true});this.render()}else{this.clear()}},clear:function(){if(this.choices){this.choices.each(function(a){a.set("checked",false)})}this.model.unset("value");this.detailsView.render();if(this.detailsView.updateCurrent){this.detailsView.updateCurrent(0)}},formatValue:function(){var a={};if(this.model.has("property")&&this.model.has("value")&&this.model.get("value").length>0){var b=_.filter(this.model.get("value"),function(a){return a[0]==="!"});if(b.length>0){b.forEach(function(b){if(b.indexOf("=")>=0){var c=b.split("=");a[c[0].substr(1)]=c[1]}else{a[b.substr(1)]=false}})}else{a[this.model.get("property")]=this.model.get("value").join(",")}}return a}});return{DetailsChoiceFilterView:b,ChoiceFilterView:c}});define("navigator/filters/more-criteria-filters",["navigator/filters/base-filters","navigator/filters/choice-filters","templates/navigator"],function(a,b){var c=b.DetailsChoiceFilterView.extend({template:Templates["more-criteria-details-filter"],events:{"click label[data-id]:not(.inactive)":"enableFilter"},enableById:function(a){this.model.view.options.filterBarView.enableFilter(a);this.model.view.hideDetails()},enableByProperty:function(a){var b=_.find(this.model.get("filters"),function(b){return b.get("property")===a});if(b){this.enableById(b.cid)}},enableFilter:function(a){var b=$j(a.target).data("id");this.enableById(b);this.updateCurrent(0)},selectCurrent:function(){this.$("label").eq(this.currentChoice).click()},serializeData:function(){var a=this.model.get("filters").map(function(a){return _.extend(a.toJSON(),{id:a.cid})}),b=function(a){return a.name},c=_.unique(a,b),d=_.sortBy(c,b);return _.extend(this.model.toJSON(),{filters:d})}});var d=b.ChoiceFilterView.extend({template:Templates["more-criteria-filter"],className:"navigator-filter navigator-filter-more-criteria",initialize:function(){b.ChoiceFilterView.prototype.initialize.call(this,{detailsView:c})},renderValue:function(){return""},renderInput:function(){},renderBase:function(){b.ChoiceFilterView.prototype.renderBase.call(this);this.$el.prop("title","")},isDefaultValue:function(){return false}});return{DetailsMoreCriteriaFilterView:c,MoreCriteriaFilterView:d}});define("navigator/filters/favorite-filters",["navigator/filters/base-filters","navigator/filters/choice-filters","templates/navigator"],function(a,b){var c=a.DetailsFilterView.extend({template:Templates["favorite-details-filter"],events:{"click label[data-id]":"applyFavorite","click .manage label":"manage"},applyFavorite:function(a){var b=$j(a.target).data("id");window.location=baseUrl+this.model.get("favoriteUrl")+"/"+b},manage:function(){window.location=baseUrl+this.model.get("manageUrl")},serializeData:function(){var a=this.model.get("choices"),b=_.sortBy(_.map(a,function(a,b){return{v:a,k:b}}),"v");return _.extend({},this.model.toJSON(),{choicesArray:b})}});var d=b.ChoiceFilterView.extend({template:Templates["favorite-filter"],className:"navigator-filter navigator-filter-favorite",initialize:function(){b.ChoiceFilterView.prototype.initialize.call(this,{detailsView:c})},renderValue:function(){return""},renderInput:function(){},isDefaultValue:function(){return false}});return{DetailsFavoriteFilterView:c,FavoriteFilterView:d}});define("navigator/filters/filter-bar",["navigator/filters/base-filters","navigator/filters/more-criteria-filters","navigator/filters/favorite-filters"],function(a){return Marionette.CompositeView.extend({itemViewContainer:".navigator-filters-list",collectionEvents:{"change:enabled":"changeEnabled"},getItemView:function(b){return b.get("type")||a.BaseFilterView},itemViewOptions:function(){return{filterBarView:this,app:this.options.app}},initialize:function(){Marionette.CompositeView.prototype.initialize.apply(this,arguments);var a=this;$j("body").on("click",function(){a.hideDetails()});this.addMoreCriteriaFilter();key.filter=function(a){var b=true,c=jQuery(a.target),d=c.closest(".navigator-filter-details-inner"),e=d.find(":tabbable"),f=c.is(":input")||c.is("a"),g=c.closest(".ui-dialog").length>0;if(f){if(!g&&(a.keyCode===9||a.keyCode===27)){b=e.index(c)>=e.length-1}else{b=false}}return b};key("tab","list",function(){key.setScope("filters");a.selectFirst();return false});key("shift+tab","filters",function(){a.selectPrev();return false});key("tab","filters",function(){a.selectNext();return false});key("escape","filters",function(){a.hideDetails();this.selected=-1;key.setScope("list")})},getEnabledFilters:function(){return this.$(this.itemViewContainer).children().not(".navigator-filter-disabled").not(".navigator-filter-inactive").not(".navigator-filter-favorite")},selectFirst:function(){this.selected=-1;this.selectNext()},selectPrev:function(){var a=this.getEnabledFilters();if(this.selected>0){a.eq(this.selected).blur();this.selected--;a.eq(this.selected).click();this.$(".navigator-filter-submit").blur()}},selectNext:function(){var a=this.getEnabledFilters();if(this.selected<a.length-1){a.eq(this.selected).blur();this.selected++;a.eq(this.selected).click()}else{this.selected=a.length;this.hideDetails();this.$(".navigator-filter-submit").focus()}},addMoreCriteriaFilter:function(){var b=this.collection.where({enabled:false});if(b.length>0){this.moreCriteriaFilter=new a.Filter({type:require("navigator/filters/more-criteria-filters").MoreCriteriaFilterView,enabled:true,optional:false,filters:b});this.collection.add(this.moreCriteriaFilter)}},onAfterItemAdded:function(a){if(a.model.get("type")===require("navigator/filters/favorite-filters").FavoriteFilterView){jQuery(".navigator-header").addClass("navigator-header-favorite")}},restoreFromQuery:function(a){this.collection.each(function(b){b.set("enabled",!b.get("optional"));b.view.clear();b.view.restoreFromQuery(a)})},hideDetails:function(){if(_.isObject(this.showedView)){this.showedView.hideDetails()}},enableFilter:function(a){var b=this.collection.get(a),c=b.view;c.$el.detach().insertBefore(this.$(".navigator-filter-more-criteria"));b.set("enabled",true);c.showDetails()},changeEnabled:function(){var a=_.reject(this.collection.where({enabled:false}),function(a){return a.get("type")===require("navigator/filters/more-criteria-filters").MoreCriteriaFilterView});if(a.length===0){this.moreCriteriaFilter.set({enabled:false},{silent:true})}else{this.moreCriteriaFilter.set({enabled:true},{silent:true})}this.moreCriteriaFilter.set("filters",a)}})});define("measures/measures-filter-bar",["navigator/filters/filter-bar"],function(a){return a.extend({template:function(){return jQuery("#filter-bar-template").html()}})});define("navigator/filters/checkbox-filters",["navigator/filters/base-filters","templates/navigator"],function(a){return a.BaseFilterView.extend({template:Templates["checkbox-filter"],className:"navigator-filter navigator-filter-inline",events:function(){return{"click .navigator-filter-disable":"disable"}},showDetails:function(){},renderInput:function(){if(this.model.get("enabled")){$j("<input>").prop("name",this.model.get("property")).prop("type","checkbox").prop("value","true").prop("checked",true).css("display","none").appendTo(this.$el)}},renderValue:function(){return this.model.get("value")},isDefaultValue:function(){return false},restore:function(a){this.model.set({value:a,enabled:true})}})});define("navigator/filters/ajax-select-filters",["navigator/filters/base-filters","navigator/filters/choice-filters","templates/navigator"],function(a,b){var c=100;var d=Backbone.Collection.extend({comparator:"text",initialize:function(){this.more=false;this.page=0},parse:function(a){this.more=a.more;return a.results},fetch:function(a){this.data=_.extend({p:1,ps:c},a.data||{});var b=_.extend({},a,{data:this.data});return Backbone.Collection.prototype.fetch.call(this,b)},fetchNextPage:function(a){if(this.more){this.data.p+=1;var b=_.extend({remove:false},a,{data:this.data});return this.fetch(b)}return false}});var e=d.extend({url:function(){return baseUrl+"/api/users/search?f=s2"}});var f=d.extend({url:function(){return baseUrl+"/api/resources/search?f=s2&q=TRK&display_key=true"}});var g=d.extend({url:function(){return baseUrl+"/api/resources/search?f=s2&qp=supportsGlobalDashboards&display_key=true"},parse:function(a){this.more=a.more;if(a.results.length>0&&a.results[0].children){var b=[];_.each(a.results,function(a){_.each(a.children,function(c){c.category=a.text;b.push(c)})});return b}else{return a.results}}});var h=b.DetailsChoiceFilterView.extend({template:Templates["ajax-select-filter"],listTemplate:Templates["choice-filter-template"],searchKey:"s",render:function(){b.DetailsChoiceFilterView.prototype.render.apply(this,arguments);var a=this,c=function(b){if(b.keyCode!==37&&b.keyCode!==38&&b.keyCode!==39&&b.keyCode!==40){a.search()}},d=_.debounce(c,250),e=function(){a.scroll()},f=_.throttle(e,1e3);this.$(".navigator-filter-search input").off("keyup keydown").on("keyup",d).on("keydown",this.keydown);this.$(".choices").off("scroll").on("scroll",f)},search:function(){var a=this;this.query=this.$(".navigator-filter-search input").val();if(this.query.length>1){this.$el.addClass("fetching");var b=a.options.filterView.getSelected(),d={ps:c};d[this.searchKey]=this.query;this.options.filterView.choices.fetch({data:d,success:function(){b.forEach(function(b){a.options.filterView.choices.unshift(b)});_.each(a.model.get("choices"),function(b,c){if(c[0]==="!"){a.options.filterView.choices.add(new Backbone.Model({id:c,text:b}))}});a.updateLists();a.$el.removeClass("fetching");a.$(".navigator-filter-search").removeClass("fetching-error")},error:function(){a.showSearchError()}})}else{this.resetChoices();this.updateLists()}},showSearchError:function(){this.$el.removeClass("fetching");this.$(".navigator-filter-search").addClass("fetching-error")},scroll:function(){var a=this,b=this.$(".choices"),c=b.scrollTop()>=b[0].scrollHeight-b.outerHeight();if(c){this.options.filterView.choices.fetchNextPage().done(function(){a.updateLists()})}},keydown:function(a){if(_([38,40,13]).indexOf(a.keyCode)!==-1){a.preventDefault()}},resetChoices:function(){var a=this;this.options.filterView.choices.reset(this.options.filterView.choices.filter(function(a){return a.get("checked")}));_.each(this.model.get("choices"),function(b,c){a.options.filterView.choices.add(new Backbone.Model({id:c,text:b}))})},onShow:function(){b.DetailsChoiceFilterView.prototype.onShow.apply(this,arguments);this.resetChoices();this.render();this.$(".navigator-filter-search input").focus()}});var i=b.ChoiceFilterView.extend({initialize:function(a){b.ChoiceFilterView.prototype.initialize.call(this,{detailsView:a&&a.detailsView?a.detailsView:h})},isDefaultValue:function(){return this.getSelected().length===0},renderInput:function(){var a=this.model.get("value")||[],b=$j("<input>").prop("name",this.model.get("property")).prop("type","hidden").css("display","none").val(a.join());b.appendTo(this.$el)},restoreFromQuery:function(a){var b=_.findWhere(a,{key:this.model.get("property")});if(this.model.get("choices")){_.each(this.model.get("choices"),function(c,d){if(d[0]==="!"){var e=_.findWhere(a,{key:d.substr(1)});if(e==null){return}if(!b){b={value:d}}else{b.value+=","+d}}})}if(b&&b.value){this.model.set("enabled",true);this.restore(b.value,b)}else{this.clear()}},restore:function(a,b){var c=this;if(_.isString(a)){a=a.split(",")}if(this.choices&&a.length>0){this.model.set({value:a,enabled:true});var d=_.filter(a,function(a){return a[0]==="!"});d.forEach(function(a){c.choices.add(new Backbone.Model({id:a,text:c.model.get("choices")[a],checked:true}))});a=_.reject(a,function(a){return a[0]==="!"});if(_.isArray(b.text)&&b.text.length===a.length){this.restoreFromText(a,b.text)}else{this.restoreByRequests(a)}}else{this.clear()}},restoreFromText:function(a,b){var c=this;_.each(a,function(a,d){c.choices.add(new Backbone.Model({id:a,text:b[d],checked:true}))});this.onRestore(a)},restoreByRequests:function(a){var b=this,c=_.map(a,function(a){return b.createRequest(a)});$j.when.apply($j,c).done(function(){b.onRestore(a)})},onRestore:function(){this.detailsView.updateLists();this.renderBase()},clear:function(){this.model.unset("value");if(this.choices){this.choices.reset([])}this.render()},createRequest:function(){}});var j=i.extend({initialize:function(){i.prototype.initialize.call(this,{detailsView:h});this.choices=new g},createRequest:function(a){var b=this;return $j.ajax({url:baseUrl+"/api/resources",type:"GET",data:{resource:a}}).done(function(a){b.selection.add(new Backbone.Model({id:a[0].key,text:a[0].name}))})}});var k=i.extend({initialize:function(){a.BaseFilterView.prototype.initialize.call(this,{detailsView:h});this.choices=new f},createRequest:function(a){var b=this;return $j.ajax({url:baseUrl+"/api/resources",type:"GET",data:{resource:a}}).done(function(a){b.choices.add(new Backbone.Model({
id:a[0].key,text:a[0].name,checked:true}))})}});var l=i.extend({initialize:function(){a.BaseFilterView.prototype.initialize.call(this,{detailsView:h});this.choices=new e},createRequest:function(a){var b=this;return $j.ajax({url:baseUrl+"/api/users/search",type:"GET",data:{logins:a}}).done(function(a){b.choices.add(new Backbone.Model({id:a.users[0].login,text:a.users[0].name+" ("+a.users[0].login+")",checked:true}))})}});var m=i.extend({initialize:function(){a.BaseFilterView.prototype.initialize.call(this,{detailsView:h});this.selection=new e;this.choices=new e},createRequest:function(a){var b=this;return $j.ajax({url:baseUrl+"/api/users/search",type:"GET",data:{logins:a}}).done(function(a){b.choices.add(new Backbone.Model({id:a.users[0].login,text:a.users[0].name+" ("+a.users[0].login+")",checked:true}))})}});return{Suggestions:d,AjaxSelectDetailsFilterView:h,AjaxSelectFilterView:i,ProjectFilterView:k,ComponentFilterView:j,AssigneeFilterView:l,ReporterFilterView:m}});define("navigator/filters/range-filters",["navigator/filters/base-filters","templates/navigator"],function(a){var b=a.DetailsFilterView.extend({template:Templates["range-filter"],events:{"change input":"change"},change:function(){var a={},b=this.$("input").eq(0).val(),c=this.$("input").eq(1).val();if(b.length>0){a[this.model.get("propertyFrom")]=b}if(c.length>0){a[this.model.get("propertyTo")]=c}this.model.set("value",a)},populateInputs:function(){var a=this.model.get("value"),b=this.model.get("propertyFrom"),c=this.model.get("propertyTo"),d=_.isObject(a)&&a[b],e=_.isObject(a)&&a[c];this.$("input").eq(0).val(d||"");this.$("input").eq(1).val(e||"")},onShow:function(){this.$(":input:first").focus()}});var c=a.BaseFilterView.extend({initialize:function(){a.BaseFilterView.prototype.initialize.call(this,{detailsView:b})},renderValue:function(){if(!this.isDefaultValue()){var a=_.values(this.model.get("value"));return a.join(" — ")}else{return window.SS.phrases.any}},renderInput:function(){var a=this.model.get("value"),b=this.model.get("propertyFrom"),c=this.model.get("propertyTo"),d=_.isObject(a)&&a[b],e=_.isObject(a)&&a[c];$j("<input>").prop("name",b).prop("type","hidden").css("display","none").val(d||"").appendTo(this.$el);$j("<input>").prop("name",c).prop("type","hidden").css("display","none").val(e||"").appendTo(this.$el)},isDefaultValue:function(){var a=this.model.get("value"),b=this.model.get("propertyFrom"),c=this.model.get("propertyTo"),d=_.isObject(a)&&a[b],e=_.isObject(a)&&a[c];return!d&&!e},restoreFromQuery:function(a){var b=_.findWhere(a,{key:this.model.get("propertyFrom")}),c=_.findWhere(a,{key:this.model.get("propertyTo")}),d={};if(b&&b.value||c&&c.value){if(b&&b.value){d[this.model.get("propertyFrom")]=b.value}if(c&&c.value){d[this.model.get("propertyTo")]=c.value}this.model.set({value:d,enabled:true});this.detailsView.populateInputs()}},restore:function(a){if(this.choices&&this.selection&&a.length>0){var b=this;this.choices.add(this.selection.models);this.selection.reset([]);_.each(a,function(a){var c=b.choices.findWhere({id:a});if(c){b.selection.add(c);b.choices.remove(c)}});this.detailsView.updateLists();this.model.set({value:a,enabled:true})}},formatValue:function(){return this.model.get("value")},clear:function(){this.model.unset("value");this.detailsView.render()}});var d=c.extend({render:function(){c.prototype.render.apply(this,arguments);this.detailsView.$("input").prop("placeholder","1970-01-31").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true}).on("change",function(){jQuery(this).datepicker("setDate",jQuery(this).val())})},renderValue:function(){if(!this.isDefaultValue()){var a=_.values(this.model.get("value"));return a.join(" — ")}else{return window.SS.phrases.anytime}}});return{RangeFilterView:c,DateRangeFilterView:d}});define("navigator/filters/string-filters",["navigator/filters/base-filters","templates/navigator"],function(a){var b=a.DetailsFilterView.extend({template:Templates["string-filter"],events:{"change input":"change"},change:function(a){this.model.set("value",$j(a.target).val())},onShow:function(){a.DetailsFilterView.prototype.onShow.apply(this,arguments);this.$(":input").focus()},serializeData:function(){return _.extend({},this.model.toJSON(),{value:this.model.get("value")||""})}});return a.BaseFilterView.extend({initialize:function(){a.BaseFilterView.prototype.initialize.call(this,{detailsView:b})},renderValue:function(){return this.isDefaultValue()?"—":this.model.get("value")},renderInput:function(){$j("<input>").prop("name",this.model.get("property")).prop("type","hidden").css("display","none").val(this.model.get("value")||"").appendTo(this.$el)},isDefaultValue:function(){return!this.model.get("value")},restore:function(a){this.model.set({value:a,enabled:true})},clear:function(){this.model.unset("value");this.detailsView.render()}})});define("navigator/filters/metric-filters",["navigator/filters/base-filters","templates/navigator"],function(a){var b=a.DetailsFilterView.extend({template:Templates["metric-filter"],events:{"change :input":"inputChanged"},inputChanged:function(){var a=this.$("[name=metric]").val(),b=a.indexOf("new_")===0,c=this.$("[name=period]"),d=c.val(),e=c.children('[value="0"]'),f={metric:a,metricText:this.$("[name=metric] option:selected").text(),period:d,periodText:this.$("[name=period] option:selected").text(),op:this.$("[name=op]").val(),opText:this.$("[name=op] option:selected").text(),val:this.$("[name=val]").val(),valText:this.$("[name=val]").originalVal()};if(b){e.remove();if(d==="0"){d="1"}}else{if(e.length===0){c.prepend(this.periodZeroOption)}}c.select2("destroy").val(d).select2({width:"100%",minimumResultsForSearch:100});this.updateDataType(f);this.model.set("value",f)},updateDataType:function(a){var b=_.find(window.SS.metrics,function(b){return b.metric.name===a.metric});if(b){this.$("[name=val]").data("type",b.metric.val_type);if(b.metric.val_type==="WORK_DUR"){this.$("[name=val]").prop("placeholder","1d 7h 59min")}if(b.metric.val_type==="RATING"){this.$("[name=val]").prop("placeholder","A")}}},onRender:function(){var a=this.$("[name=period]").children('[value="0"]').html();this.periodZeroOption='<option value="0">'+a+"</option>";var b=this.model.get("value")||{};this.$("[name=metric]").val(b.metric).select2({width:"100%",placeholder:window.SS.phrases.metric});this.$("[name=period]").val(b.period||0).select2({width:"100%",minimumResultsForSearch:100});this.$("[name=op]").val(b.op||"eq").select2({width:"60px",placeholder:"=",minimumResultsForSearch:100});this.updateDataType(b);this.$("[name=val]").val(b.val);this.inputChanged()},onShow:function(){var a=this.$("[name=metric]");if(this.model.get("value").metric===""){a.select2("open")}else{a.select2("focus")}}});return a.BaseFilterView.extend({initialize:function(){a.BaseFilterView.prototype.initialize.call(this,{detailsView:b});this.groupMetrics()},groupMetrics:function(){var a=_.map(this.model.get("metrics"),function(a){return a.metric}),b=_.sortBy(_.map(_.groupBy(a,"domain"),function(a,b){return{domain:b,metrics:_.sortBy(a,"short_name")}}),"domain");this.model.set("groupedMetrics",b)},renderValue:function(){return this.isDefaultValue()?window.SS.phrases.notSet:this.model.get("value").metricText+" "+this.model.get("value").opText+" "+this.model.get("value").valText},renderInput:function(){var a=this,b=this.model.get("value");if(_.isObject(b)&&b.metric&&b.op&&b.val!=null){_.each(["metric","period","op","val"],function(c){var d=b[c];if(c==="period"&&d==="0"){d=""}$j("<input>").prop("name",a.model.get("property")+"_"+c).prop("type","hidden").css("display","none").val(d).appendTo(a.$el)})}},isDefaultValue:function(){var a=this.model.get("value");if(!_.isObject(a)){return true}return!(a.metric&&a.op&&a.val!=null)},restoreFromQuery:function(a){var b=this,c={};_.each(["metric","period","op","val"],function(d){var e=b.model.get("property")+"_"+d,f=_.findWhere(a,{key:e});if(f&&f.value){c[d]=f.value}});if(c&&c.metric&&c.op&&c.val!=null){this.model.set({value:c,enabled:true})}}})});requirejs.config({baseUrl:baseUrl+"/js"});requirejs(["measures/measures-filter-bar","navigator/filters/base-filters","navigator/filters/checkbox-filters","navigator/filters/choice-filters","navigator/filters/ajax-select-filters","navigator/filters/favorite-filters","navigator/filters/range-filters","navigator/filters/string-filters","navigator/filters/metric-filters"],function(a,b,c,d,e,f,g,h,i){var j=new Marionette.Application;j.addRegions({filtersRegion:".navigator-filters"});j.addInitializer(function(){this.filters=new b.Filters;if(_.isObject(window.SS.favorites)){this.filters.add([new b.Filter({type:f.FavoriteFilterView,enabled:true,optional:false,choices:window.SS.favorites,favoriteUrl:"/measures/filter",manageUrl:"/measures/manage"})])}this.filters.add([new b.Filter({name:window.SS.phrases.components,property:"qualifiers[]",type:d.ChoiceFilterView,enabled:true,optional:false,choices:window.SS.qualifiers,defaultValue:window.SS.phrases.any}),new b.Filter({name:window.SS.phrases.componentsOf,property:"base",type:e.ComponentFilterView,multiple:false,enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.favoritesOnly,property:"onFavourites",type:c,enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.date,propertyFrom:"fromDate",propertyTo:"toDate",type:g.DateRangeFilterView,enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.keyContains,property:"keySearch",type:h,enabled:false,optional:true})])});j.addInitializer(function(){this.filters.add([new b.Filter({name:window.SS.phrases.lastAnalysis,propertyFrom:"ageMinDays",propertyTo:"ageMaxDays",type:g.RangeFilterView,placeholder:window.SS.phrases.days,enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.metric,property:"c3",type:i,metrics:window.SS.metrics,periods:window.SS.metricPeriods,operations:{eq:"=",lt:"<",lte:"≤",gt:">",gte:"≥"},enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.metric,property:"c2",type:i,metrics:window.SS.metrics,periods:window.SS.metricPeriods,operations:{eq:"=",lt:"<",lte:"≤",gt:">",gte:"≥"},enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.metric,property:"c1",type:i,metrics:window.SS.metrics,periods:window.SS.metricPeriods,operations:{eq:"=",lt:"<",lte:"≤",gt:">",gte:"≥"},enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.nameContains,property:"nameSearch",type:h,enabled:false,optional:true}),new b.Filter({name:window.SS.phrases.alert,property:"alertLevels[]",type:d.ChoiceFilterView,enabled:false,optional:true,choices:{error:window.SS.phrases.error,warn:window.SS.phrases.warning,ok:window.SS.phrases.ok}})]);this.filterBarView=new a({collection:this.filters,extra:{sort:"",asc:false}});this.filtersRegion.show(this.filterBarView)});j.start();if(window.queryParams){j.filterBarView.restoreFromQuery(window.queryParams)}key.setScope("list")});define("measures/app",function(){});