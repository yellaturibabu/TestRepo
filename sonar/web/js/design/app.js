this["Templates"]=this["Templates"]||{};this["Templates"]["design"]=Handlebars.template({1:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return'    <li>\n      <input class="js-hide-dir" type="checkbox" id="design-hide-empty-dir" checked>\n      <label for="design-hide-empty-dir">'+f((b.t||a&&a.t||e).call(a,"design.hide_empty_directories",{name:"t",hash:{},data:d}))+"</label>\n    </li>\n"},3:function(a,b,c,d,e){var f,g,h=b.helperMissing,i=this.escapeExpression,j="function",k="      <tr ";f=b["if"].call(a,a!=null?a.empty:a,{name:"if",hash:{},fn:this.program(4,d,e),inverse:this.noop,data:d});if(f!=null){k+=f}k+='>\n        <td class="dsm-body-title" title="'+i((b.t||a&&a.t||h).call(a,"design.rowTooltip",{name:"t",hash:{},data:d}))+'">\n          '+i((b.qualifierIcon||a&&a.qualifierIcon||h).call(a,a!=null?a.q:a,{name:"qualifierIcon",hash:{},data:d}))+" "+i((g=(g=b.n||(a!=null?a.n:a))!=null?g:h,typeof g===j?g.call(a,{name:"n",hash:{},data:d}):g))+"\n";f=(b.gt||a&&a.gt||h).call(a,a!=null?a.pt:a,0,{name:"gt",hash:{},fn:this.program(6,d,e),inverse:this.noop,data:d});if(f!=null){k+=f}k+='          <span class="dsm-body-title-indicator"></span>\n        </td>\n';f=(b.eachIndex||a&&a.eachIndex||h).call(a,a!=null?a.v:a,{name:"eachIndex",hash:{},fn:this.program(8,d,e),inverse:this.noop,data:d});if(f!=null){k+=f}return k+"      </tr>\n"},4:function(a,b,c,d){return"data-empty"},6:function(a,b,c,d){var e,f=b.helperMissing,g=this.escapeExpression,h="function";return'            <span class="dsm-body-title-package-tangles" title="'+g((b.t||a&&a.t||f).call(a,"metric.package_cycles.name",{name:"t",hash:{},data:d}))+'">'+g((e=(e=b.pt||(a!=null?a.pt:a))!=null?e:f,typeof e===h?e.call(a,{name:"pt",hash:{},data:d}):e))+"</span>\n"},8:function(a,b,c,d,e){var f,g=b.helperMissing,h=this.escapeExpression,i='          <td class="dsm-body-cell ';f=b["if"].call(a,a!=null?a.status:a,{name:"if",hash:{},fn:this.program(9,d,e),inverse:this.noop,data:d});if(f!=null){i+=f}i+='" title="'+h((b.t||a&&a.t||g).call(a,"design.cellTooltip",{name:"t",hash:{},data:d}))+'">\n            ';f=(b.eq||a&&a.eq||g).call(a,a!=null?a.index:a,e[1]!=null?e[1].index:e[1],{name:"eq",hash:{},fn:this.program(11,d,e),inverse:this.program(13,d,e),data:d});if(f!=null){i+=f}return i+"\n          </td>\n"},9:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return"dsm-body-cell-"+h((e=(e=b.status||(a!=null?a.status:a))!=null?e:g,typeof e===f?e.call(a,{name:"status",hash:{},data:d}):e))},11:function(a,b,c,d){return"â€“"},13:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return h((e=(e=b.w||(a!=null?a.w:a))!=null?e:g,typeof e===f?e.call(a,{name:"w",hash:{},data:d}):e))},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d,e){var f,g=b.helperMissing,h=this.escapeExpression,i='<header class="page-header">\n  <h1 class="page-title">'+h((b.t||a&&a.t||g).call(a,"design.page",{name:"t",hash:{},data:d}))+'</h1>\n  <div class="page-actions">\n    <i class="icon-help"></i>&nbsp;<a href="http://redirect.sonarsource.com/doc/dsm.html">'+h((b.t||a&&a.t||g).call(a,"design.help",{name:"t",hash:{},data:d}))+'</a>\n  </div>\n</header>\n\n<ul class="dsm-legend">\n  <li>\n    <span class="dsm-legend-square gray"></span>\n    <span class="dsm-legend-label">'+h((b.t||a&&a.t||g).call(a,"design.legend.dependencies",{name:"t",hash:{},data:d}))+'</span>\n  </li>\n  <li>\n    <span class="dsm-legend-square red"></span>\n    <span class="dsm-legend-label">'+h((b.t||a&&a.t||g).call(a,"design.legend.cycles",{name:"t",hash:{},data:d}))+'</span>\n  </li>\n  <li>\n    <span class="dsm-legend-square green"></span>\n    <span class="dsm-legend-label">'+h((b.t||a&&a.t||g).call(a,"design.legend.uses",{name:"t",hash:{},data:d}))+'</span>\n    <span class="dsm-legend-square blue"></span>\n    <span class="dsm-legend-label">'+h((b.t||a&&a.t||g).call(a,"design.legend.uses",{name:"t",hash:{},data:d}))+'</span>\n    <span class="dsm-legend-square yellow"></span>\n  </li>\n';f=b["if"].call(a,a!=null?a.hasDirectories:a,{name:"if",hash:{},fn:this.program(1,d,e),inverse:this.noop,data:d});if(f!=null){i+=f}i+='</ul>\n\n<div class="dsm-body">\n  <table>\n    <tbody>\n';f=(b.eachIndex||a&&a.eachIndex||g).call(a,a!=null?a.items:a,{name:"eachIndex",hash:{},fn:this.program(3,d,e),inverse:this.noop,data:d});if(f!=null){i+=f}return i+'    </tbody>\n  </table>\n</div>\n\n<div class="dsm-info"></div>\n'},useData:true,useDepths:true});this["Templates"]["dsm-info"]=Handlebars.template({1:function(a,b,c,d){var e,f,g=b.helperMissing,h=this.escapeExpression,i="function",j="    <tr>\n      <td ";e=b["if"].call(a,a!=null?a.changed:a,{name:"if",hash:{},fn:this.program(2,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+=">\n";e=b["if"].call(a,a!=null?a.changed:a,{name:"if",hash:{},fn:this.program(4,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+="      </td>\n      <td ";e=b["if"].call(a,a!=null?a.changed:a,{name:"if",hash:{},fn:this.program(2,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+=">\n";e=b["if"].call(a,a!=null?a.changed:a,{name:"if",hash:{},fn:this.program(6,d),inverse:this.noop,data:d});if(e!=null){j+=e}j+="      </td>\n      <td ";e=b["if"].call(a,a!=null?a.changed:a,{name:"if",hash:{},fn:this.program(2,d),inverse:this.noop,data:d});if(e!=null){j+=e}return j+">\n        "+h((b.qualifierIcon||a&&a.qualifierIcon||g).call(a,a!=null?a.tq:a,{name:"qualifierIcon",hash:{},data:d}))+'\n        <a href="'+h((b.dashboardUrl||a&&a.dashboardUrl||g).call(a,a!=null?a.tk:a,{name:"dashboardUrl",hash:{},data:d}))+'"> '+h((f=(f=b.tn||(a!=null?a.tn:a))!=null?f:g,typeof f===i?f.call(a,{name:"tn",hash:{},data:d}):f))+" </a>\n      </td>\n    </tr>\n"},2:function(a,b,c,d){return'class="changed"'},4:function(a,b,c,d){var e,f=b.helperMissing,g=this.escapeExpression,h="function";return"          "+g((b.qualifierIcon||a&&a.qualifierIcon||f).call(a,a!=null?a.fq:a,{name:"qualifierIcon",hash:{},data:d}))+'\n          <a href="'+g((b.dashboardUrl||a&&a.dashboardUrl||f).call(a,a!=null?a.fk:a,{name:"dashboardUrl",hash:{},data:d}))+'">'+g((e=(e=b.fn||(a!=null?a.fn:a))!=null?e:f,typeof e===h?e.call(a,{name:"fn",hash:{},data:d}):e))+"</a>\n"},6:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return"          "+h((e=(e=b.u||(a!=null?a.u:a))!=null?e:g,typeof e===f?e.call(a,{name:"u",hash:{},data:d}):e))+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f=b.helperMissing,g=this.escapeExpression,h=this.lambda,i="<table>\n  <thead>\n  <tr>\n    <th>"+g((b.qualifierIcon||a&&a.qualifierIcon||f).call(a,(e=a!=null?a.first:a)!=null?e.q:e,{name:"qualifierIcon",hash:{},data:d}))+" "+g(h((e=a!=null?a.first:a)!=null?e.n:e,a))+"</th>\n    <th>&nbsp;</th>\n    <th>"+g((b.qualifierIcon||a&&a.qualifierIcon||f).call(a,(e=a!=null?a.second:a)!=null?e.q:e,{name:"qualifierIcon",hash:{},data:d}))+" "+g(h((e=a!=null?a.second:a)!=null?e.n:e,a))+"</th>\n  </tr>\n  </thead>\n  <tbody>\n";e=(b.eachChanged||a&&a.eachChanged||f).call(a,a!=null?a.items:a,"fk",{name:"eachChanged",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e!=null){i+=e}return i+"  </tbody>\n</table>\n"},useData:true});define("templates/design",function(){});(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("design/info-view",["templates/design"],function(){return function(a){b(c,a);function c(){return c.__super__.constructor.apply(this,arguments)}c.prototype.template=Templates["dsm-info"];c.prototype.serializeData=function(){return _.extend(c.__super__.serializeData.apply(this,arguments),{first:this.options.first,second:this.options.second})};return c}(Marionette.ItemView)})}).call(this);(function(){var a={}.hasOwnProperty,b=function(b,c){for(var d in c){if(a.call(c,d))b[d]=c[d]}function e(){this.constructor=b}e.prototype=c.prototype;b.prototype=new e;b.__super__=c.prototype;return b};define("design/view",["design/info-view","templates/design"],function(a){var c,d;c=jQuery;d=""+baseUrl+"/api/dependencies";return function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.template=Templates["design"];f.prototype.className="dsm";f.prototype.regions={infoRegion:".dsm-info"};f.prototype.ui={titles:".dsm-body-title",cells:".dsm-body-cell",dependencies:".dsm-body-dependency"};f.prototype.events={"click @ui.titles":"highlightComponent","dblclick @ui.titles":"goToComponent","click @ui.cells":"highlightCell","dblclick @ui.dependencies":"showDependencies","change .js-hide-dir":"toggleDirDisplay"};f.prototype.onRender=function(){return this.toggleDirDisplay()};f.prototype.clearCells=function(){this.ui.titles.removeClass("dsm-body-highlighted dsm-body-usage dsm-body-dependency");return this.ui.cells.removeClass("dsm-body-highlighted dsm-body-usage dsm-body-dependency")};f.prototype.highlightComponent=function(a){var b;b=this.ui.titles.index(c(a.currentTarget));this.clearCells();this.highlightRow(b);this.highlightColumn(b);this.highlightUsages(b);return this.highlightDependencies(b)};f.prototype.highlightCell=function(a){var b,d,e;b=c(a.currentTarget);d=b.parent().children().index(b)-1;e=b.parent().parent().children().index(b.parent());this.clearCells();if(e===d){this.highlightRow(e);this.highlightColumn(e);this.highlightUsages(e);return this.highlightDependencies(e)}else{this.highlightRow(d,"dsm-body-usage");this.highlightColumn(d,"dsm-body-usage");this.highlightRow(e,"dsm-body-dependency");return this.highlightColumn(e,"dsm-body-dependency")}};f.prototype.highlightRow=function(a,b){if(b==null){b="dsm-body-highlighted"}return this.$(".dsm-body tr:eq("+a+") td").addClass(b)};f.prototype.highlightColumn=function(a,b){if(b==null){b="dsm-body-highlighted"}return this.$(".dsm-body tr").each(function(){return c(this).find("td:eq("+(a+1)+")").addClass(b)})};f.prototype.highlightUsages=function(a){return this.collection.at(a).get("v").forEach(function(b){return function(c,d){if(d<a&&c.w!=null){return b.$("tr:eq("+d+") .dsm-body-title").addClass("dsm-body-usage")}}}(this))};f.prototype.highlightDependencies=function(a){return this.collection.forEach(function(b){return function(c,d){if(c.get("v")[a].w!=null){return b.$("tr:eq("+d+") .dsm-body-title").addClass("dsm-body-dependency")}}}(this))};f.prototype.goToComponent=function(a){var b,d,e,f;b=c(a.currentTarget);f=b.parent().parent().children().index(b.parent());d=this.collection.at(f);e=d.get("q")==="CLA"||d.get("q")==="FIL"?"dashboard":"design";return window.location=""+baseUrl+"/"+e+"/index/"+d.get("i")};f.prototype.showDependencies=function(b){var e,f,g,h;e=c(b.currentTarget);f=e.parent().children().index(e)-1;h=e.parent().parent().children().index(e.parent());g=this.collection.at(h).get("v")[f].i;if(!g){return}this.showInfoViewSpinner();this.scrollToInfoView();return c.get(d,{parent:g},function(b){return function(c){b.infoRegion.show(new a({collection:new Backbone.Collection(c),first:b.collection.at(f).toJSON(),second:b.collection.at(h).toJSON()}));return b.scrollToInfoView()}}(this))};f.prototype.showInfoViewSpinner=function(){this.infoRegion.reset();return this.$(this.infoRegion.el).html('<i class="spinner"></i>')};f.prototype.scrollToInfoView=function(){var a;a=this.$(this.infoRegion.el).offset().top-40;return c("html, body").animate({scrollTop:a},500)};f.prototype.toggleDirDisplay=function(){var a;a=this.$("tr");return a.each(function(b){if(c(this).data("empty")!=null){c(this).toggleClass("hidden");return a.each(function(){return c(this).find("td").eq(b+1).toggleClass("hidden")})}})};f.prototype.serializeData=function(){var a;a=this.collection.some(function(a){return a.get("q")==="DIR"});return _.extend(f.__super__.serializeData.apply(this,arguments),{hasDirectories:a})};return f}(Marionette.Layout)})}).call(this);(function(){requirejs.config({baseUrl:""+baseUrl+"/js"});requirejs(["design/view"],function(a){var b,c,d,e;b=jQuery;d=""+baseUrl+"/api/resources";c=new Marionette.Application;c.noDataAvailable=function(){var a;a=t("design.noData");return b("#project-design").html('<p class="message-alert"><i class="icon-alert-warn"></i> '+a+"</p>")};c.addInitializer(function(){var e,f,g;f={};g=b.get(d,{resource:window.resourceKey,depth:1,metrics:"package_tangles"},function(a){return a.forEach(function(a){return f[a.id]=a.msr[0].frmt_val})});e=b.get(d,{resource:window.resourceKey,metrics:"dsm"});e.fail(function(){return c.noDataAvailable()});return b.when(g,e).done(function(){var d,g,h;h=e.responseJSON;if(!(_.isArray(h)&&h.length===1&&_.isArray(h[0].msr))){c.noDataAvailable();return}g=JSON.parse(h[0].msr[0].data);g.forEach(function(a,b){return a.v.forEach(function(a,c){if(a.w!=null&&a.w>0){if(b<c){return a.status="cycle"}else{return a.status="dependency"}}})});g=g.map(function(a){return _.extend(a,{empty:a.q==="DIR"&&a.v.every(function(a){return a.w==null})})});d=new Backbone.Collection(g);d.forEach(function(a){return a.set("pt",f[a.get("i")])});this.view=new a({app:this,collection:d});return b("#project-design").empty().append(this.view.render().el)})});e=window.requestMessages();return jQuery.when(e).done(function(){return c.start()})})}).call(this);define("design/app",function(){});